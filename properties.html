<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PropEase — Properties</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body data-role="properties">
  <div class="topbar">
    <button class="hamburger" aria-label="menu">☰</button>

    <div class="brand-header">
      <img src="assets/logo.jpg" class="site-logo--small" alt="RACERSREALESTATE.CO">
      <div class="brand-text">RACERSREALESTATE.CO</div>
    </div>

    <div class="top-title">Properties</div>

    <div class="top-actions">
      <div class="muted" id="signedInAs">Signed in</div>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="brand-mini"><img src="assets/logo.jpg" alt="logo"></div>
      <nav>
        <a href="admin.html"><span class="icon"><img src="assets/icons/dashboard.png" alt=""></span>Dashboard</a>
        <a href="properties.html" class="active"><span class="icon"><img src="assets/icons/properties.png" alt=""></span>Properties</a>
        <a href="leases.html"><span class="icon"><img src="assets/icons/leases.png" alt=""></span>Leases</a>
        <a href="clients.html"><span class="icon"><img src="assets/icons/clients.png" alt=""></span>Clients</a>
      </nav>
      <div class="support"><span class="icon"><img src="assets/icons/support.png" alt="support"></span>Help</div>
    </aside>

    <main class="main">
      <header>
        <h2>Property Portfolio</h2>
        <p class="muted">Browse properties, view occupancy and schedule viewings.</p>
      </header>

      <section style="display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div style="display:flex;gap:8px;align-items:center">
            <input id="propSearch" placeholder="Search property or city" style="padding:10px;border-radius:8px;border:1px solid #eee;width:360px"/>
            <select id="propFilterCity" style="padding:10px;border-radius:8px;border:1px solid #eee">
              <option value="all">All cities</option>
              <option value="New York">New York</option>
              <option value="Chicago">Chicago</option>
              <option value="Boston">Boston</option>
              <option value="San Diego">San Diego</option>
            </select>
            <button id="btnFilterClear" class="btn">Clear</button>
          </div>

          <div style="display:flex;gap:8px">
            <button id="btnNewProperty" class="btn">New Property</button>
            <button id="btnExportProps" class="btn">Export</button>
          </div>
        </div>

        <div id="propertiesGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px"></div>

        <div class="card" style="padding:12px">
          <h4 style="margin:0 0 8px">Portfolio Summary</h4>
          <div id="propsSummary" class="muted">—</div>
        </div>
      </section>
    </main>
  </div>

  <!-- Property detail modal -->
  <div id="propModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:120">
    <div style="background:#fff;border-radius:10px;padding:18px;max-width:720px;width:100%;box-shadow:0 20px 50px rgba(0,0,0,0.25)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="propModalTitle" style="margin:0">Property</h3>
        <button id="propModalClose" class="btn">Close</button>
      </div>
      <div id="propModalBody" style="margin-top:12px;color:#333"></div>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button id="propModalSchedule" class="btn primary">Schedule Viewing</button>
        <button id="propModalManage" class="btn">Manage</button>
      </div>
    </div>
  </div>

  <script src="js/script.js"></script>
  <script>
    (function(){
      const properties = [
        { id:'p1', name:'Midtown Residences', city:'New York', units:120, occupied:118, address:'120 Broadway Ave', img:'../assets/prop1.jpg' },
        { id:'p2', name:'Riverside Tower', city:'Chicago', units:88, occupied:83, address:'7 River St', img:'../assets/prop2.jpg' },
        { id:'p3', name:'Oakwood Apartments', city:'Boston', units:54, occupied:49, address:'9 Oak St', img:'../assets/prop3.jpg' },
        { id:'p4', name:'Harbor View', city:'San Diego', units:72, occupied:64, address:'1 Harbor Rd', img:'../assets/prop4.jpg' }
      ];

      const grid = document.getElementById('propertiesGrid');
      const summaryEl = document.getElementById('propsSummary');
      const searchInput = document.getElementById('propSearch');
      const cityFilter = document.getElementById('propFilterCity');

      function renderGrid(list){
        grid.innerHTML = list.map(p => `
          <div class="card" style="padding:12px;display:flex;flex-direction:column;gap:10px">
            <div style="display:flex;gap:12px;align-items:center">
              <div style="width:84px;height:64px;border-radius:8px;overflow:hidden;background:#f2f2f2;flex:0 0 84px">
                <img src="${p.img}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover"/>
              </div>
              <div style="flex:1">
                <strong>${p.name}</strong>
                <div class="muted" style="font-size:13px">${p.address} • ${p.city}</div>
                <div style="margin-top:8px" class="muted">Occupancy: ${p.occupied}/${p.units}</div>
              </div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="muted" style="font-size:13px">Income est: $${Math.round(p.occupied * 1200).toLocaleString()}</div>
              <div>
                <button class="btn btn-view" data-id="${p.id}">View</button>
                <button class="btn btn-schedule" data-id="${p.id}">Schedule</button>
                <button class="btn btn-manage" data-id="${p.id}">Manage</button>
              </div>
            </div>
          </div>
        `).join('');
        attachCardActions();
        renderSummary(list);
      }

      function renderSummary(list){
        const total = list.length;
        const units = list.reduce((s,p)=>s+p.units,0);
        const occ = list.reduce((s,p)=>s+p.occupied,0);
        summaryEl.textContent = `Properties: ${total} • Units: ${units} • Occupied: ${occ} (${Math.round(occ/units*100)}%)`;
      }

      function attachCardActions(){
        grid.querySelectorAll('.btn-view').forEach(b=>{
          b.addEventListener('click', ev=>{
            const id = b.dataset.id;
            const p = properties.find(x=>x.id===id);
            showProperty(p);
          });
        });
        grid.querySelectorAll('.btn-schedule').forEach(b=>{
          b.addEventListener('click', ev=>{
            const id = b.dataset.id;
            alert('Schedule viewing for ' + id + ' (demo)');
          });
        });
        grid.querySelectorAll('.btn-manage').forEach(b=>{
          b.addEventListener('click', ev=>{
            const id = b.dataset.id;
            alert('Open management for ' + id + ' (demo)');
          });
        });
      }

      // property modal
      const modal = document.getElementById('propModal');
      function showProperty(p){
        if(!p) return;
        document.getElementById('propModalTitle').textContent = p.name;
        document.getElementById('propModalBody').innerHTML = `
          <img src="${p.img}" alt="${p.name}" style="width:100%;height:160px;object-fit:cover;border-radius:8px;margin-bottom:8px"/>
          <div><strong>Address:</strong> ${p.address}, ${p.city}</div>
          <div><strong>Units:</strong> ${p.units} • <strong>Occupied:</strong> ${p.occupied}</div>
          <div style="margin-top:8px" class="muted">Quick actions and contact details appear here.</div>
        `;
        modal.style.display = 'flex';
        document.getElementById('propModalSchedule').onclick = ()=>{ alert('Schedule viewing (demo)'); };
        document.getElementById('propModalManage').onclick = ()=>{ alert('Open management (demo)'); };
      }
      document.getElementById('propModalClose').addEventListener('click', ()=> modal.style.display='none');
      modal.addEventListener('click', ev => { if(ev.target === modal) modal.style.display='none'; });

      // filters
      function filtered(){
        const q = (searchInput.value||'').toLowerCase().trim();
        const city = (cityFilter.value||'all');
        return properties.filter(p=>{
          if(city !== 'all' && p.city !== city) return false;
          if(!q) return true;
          return (p.name + ' ' + p.city + ' ' + p.address).toLowerCase().includes(q);
        });
      }

      searchInput.addEventListener('input', ()=> renderGrid(filtered()));
      cityFilter.addEventListener('change', ()=> renderGrid(filtered()));
      document.getElementById('btnFilterClear').addEventListener('click', ()=>{ searchInput.value=''; cityFilter.value='all'; renderGrid(filtered());});

      // New property / export
      document.getElementById('btnNewProperty').addEventListener('click', ()=> alert('Open new property form (demo)'));
      document.getElementById('btnExportProps').addEventListener('click', ()=>{
        const csv = properties.map(p=>[p.id,p.name,p.city,p.units,p.occupied,p.address].join(',')).join('\n');
        const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'properties.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      // initial render
      renderGrid(properties);

      try {
        const s = sessionStorage.getItem('pe_session');
        if(s) document.getElementById('signedInAs').textContent = 'Signed in as ' + JSON.parse(s).name;
      } catch(e){}
      window.__demoProperties = properties;
    })();
  </script>
</body>
</html>
