<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PropEase — Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body data-role="manager">
  <div class="topbar">
    <button class="hamburger" aria-label="menu">☰</button>

    <div class="brand-header">
      <img src="assets/logo.jpg" class="site-logo--small" alt="RACERSREALESTATE.CO">
      <div class="brand-text">RACERSREALESTATE.CO</div>
    </div>

    <div class="top-title">Manager Dashboard</div>

    <div class="top-actions">
      <div class="muted">Signed in as <strong>Manager Demo</strong></div>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="brand-mini"><img src="assets/logo.jpg" alt="logo"></div>
      <nav>
        <a href="manager.html" class="active"><span class="icon"><img src="assets/icons/dashboard.png" alt="dashboard"></span>Overview</a>
        <a href="properties.html"><span class="icon"><img src="assets/icons/properties.png" alt="properties"></span>Properties</a>
        <a href="tenants.html"><span class="icon"><img src="assets/icons/clients.png" alt="tenants"></span>Tenants</a>
        <a href="clients.html"><span class="icon"><img src="assets/icons/clients.png" alt="clients"></span>Clients</a>
        <a href="leases.html"><span class="icon"><img src="assets/icons/leases.png" alt="leases"></span>Leases</a>
        <a href="reports.html"><span class="icon"><img src="assets/icons/charts.png" alt="reports"></span>Reports</a>
      </nav>
      <div class="support"><span class="icon"><img src="assets/icons/support.png" alt="support"></span>Help</div>
    </aside>

    <main class="main">
      <header>
        <h2>Manager Overview</h2>
        <p class="muted">Quickly manage properties, tenants and clients — generate reports and take actions.</p>
      </header>

      <section class="panel" style="display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start">
        <div>
          <!-- KPIs -->
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:12px">
            <div class="card" style="padding:14px">
              <div class="muted">Properties Managed</div>
              <div id="mgrKpiProps" class="big">34</div>
              <div class="muted" style="font-size:13px">Portfolio units: <strong id="mgrKpiUnits">1,248</strong></div>
            </div>
            <div class="card" style="padding:14px">
              <div class="muted">Active Tenants</div>
              <div id="mgrKpiTenants" class="big">879</div>
              <div class="muted" style="font-size:13px">Pending applications: <strong id="mgrKpiPending">12</strong></div>
            </div>
            <div class="card" style="padding:14px">
              <div class="muted">Clients</div>
              <div id="mgrKpiClients" class="big">210</div>
              <div class="muted" style="font-size:13px">Prospects (30d): <strong id="mgrKpiLeads">28</strong></div>
            </div>
            <div class="card" style="padding:14px">
              <div class="muted">Open Maintenance</div>
              <div id="mgrKpiMaint" class="big">9</div>
              <div class="muted" style="font-size:13px">Avg resolution: <strong id="mgrKpiSla">48h</strong></div>
            </div>
          </div>

          <!-- Charts & map -->
          <div style="display:flex;gap:18px;flex-wrap:wrap;margin-bottom:12px">
            <div style="flex:1;min-width:320px;padding:16px;background:#fff;border-radius:12px;">
              <h4 style="margin:0 0 8px">Units by Property</h4>
              <canvas id="mgrBar" width="600" height="260"></canvas>
            </div>

            <div style="width:330px;min-width:260px;padding:16px;background:#fff;border-radius:12px;">
              <h4 style="margin:0 0 8px">Occupancy Status</h4>
              <canvas id="mgrDonut" width="320" height="220"></canvas>
              <div class="muted" style="margin-top:8px">Occupied vs Vacant across your portfolio</div>
            </div>
          </div>

          <!-- Tenants table -->
          <div class="card" style="padding:12px;margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <h4 style="margin:0">Recent Tenants</h4>
              <div class="muted">Updated now</div>
            </div>
            <div style="overflow:auto;margin-top:10px">
              <table class="table" style="min-width:820px">
                <thead><tr><th>Name</th><th>Unit</th><th>Property</th><th>Lease</th><th>Rent</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="mgrTenantsBody">
                  <!-- populated by script below -->
                </tbody>
              </table>
            </div>
          </div>

        </div>

        <!-- Right column: quick actions & report generator -->
        <aside>
          <div class="card" style="padding:12px;margin-bottom:12px">
            <h4 style="margin:0 0 8px">Quick Actions</h4>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn" id="btnNewTenant">Add Tenant</button>
              <button class="btn" id="btnNewProperty">Add Property</button>
              <button class="btn" id="btnInviteClient">Invite Client</button>
              <button class="btn" id="btnExport">Export Properties</button>
            </div>
          </div>

          <div class="card" style="padding:12px;margin-bottom:12px">
            <h4 style="margin:0 0 8px">Generate Property Report</h4>
            <div style="display:flex;flex-direction:column;gap:8px">
              <label class="muted">Property</label>
              <select id="reportProperty">
                <option value="all">All Properties</option>
                <option value="Midtown Residences">Midtown Residences</option>
                <option value="Riverside Tower">Riverside Tower</option>
                <option value="Oakwood Apartments">Oakwood Apartments</option>
                <option value="Harbor View">Harbor View</option>
              </select>

              <label class="muted">Date range</label>
              <input id="reportFrom" type="date"/>
              <input id="reportTo" type="date"/>

              <div style="display:flex;gap:8px">
                <button id="generateReportBtn" class="btn primary" style="flex:1">Generate</button>
                <button id="downloadReportBtn" class="btn" style="flex:1">Download CSV</button>
              </div>

              <div id="reportPreview" class="muted" style="font-size:13px;margin-top:8px">No report generated yet.</div>
            </div>
          </div>

          <div class="card" style="padding:12px">
            <h4 style="margin:0 0 8px">Top Properties</h4>
            <div id="mgrTopProps" style="display:flex;flex-direction:column;gap:8px">
              <!-- populated by script -->
            </div>
          </div>
        </aside>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/script.js"></script>
  <script>
    (function(){
      // sample manager data
      const properties = [
        {name:'Midtown Residences', units:120, occupied:118, income:42000},
        {name:'Riverside Tower', units:88, occupied:83, income:28500},
        {name:'Oakwood Apartments', units:54, occupied:49, income:14800},
        {name:'Harbor View', units:72, occupied:64, income:21500},
        {name:'Garden Lofts', units:36, occupied:31, income:9800}
      ];
      const tenants = [
        {name:'Alex Porter', unit:'204', property:'Midtown Residences', lease:'2024-01-01 → 2025-01-01', rent:1250, status:'Active'},
        {name:'Jamie Lee', unit:'110', property:'Riverside Tower', lease:'2023-09-15 → 2024-09-14', rent:1450, status:'Pending'},
        {name:'Rita Gomez', unit:'7B', property:'Oakwood Apartments', lease:'2024-02-10 → 2025-02-09', rent:980, status:'Active'},
        {name:'Michael C.', unit:'302', property:'Harbor View', lease:'2023-12-01 → 2024-11-30', rent:2200, status:'Expiring'}
      ];

      // Populate KPIs
      document.getElementById('mgrKpiProps').textContent = properties.length;
      document.getElementById('mgrKpiUnits').textContent = properties.reduce((s,p)=>s+p.units,0);
      document.getElementById('mgrKpiTenants').textContent = tenants.filter(t=>t.status!=='Terminated').length;
      document.getElementById('mgrKpiPending').textContent = tenants.filter(t=>t.status.toLowerCase().includes('pending')).length;
      document.getElementById('mgrKpiClients').textContent = 210;
      document.getElementById('mgrKpiLeads').textContent = 28;
      document.getElementById('mgrKpiMaint').textContent = 9;
      document.getElementById('mgrKpiSla').textContent = '48h';

      // Populate tenants table
      const tbody = document.getElementById('mgrTenantsBody');
      tbody.innerHTML = tenants.map(t=>`
        <tr>
          <td><strong>${t.name}</strong></td>
          <td>${t.unit}</td>
          <td>${t.property}</td>
          <td>${t.lease}</td>
          <td>$${t.rent}</td>
          <td class="muted">${t.status}</td>
          <td><button class="btn">View</button> <button class="btn">Contact</button></td>
        </tr>
      `).join('');

      // Top properties list
      const topProps = document.getElementById('mgrTopProps');
      topProps.innerHTML = properties.slice(0,3).map(p=>`<div style="display:flex;justify-content:space-between"><div><strong>${p.name}</strong><div class="muted" style="font-size:13px">${p.occupied}/${p.units} occupied</div></div><div class="muted">$${p.income.toLocaleString()}</div></div>`).join('');

      // Charts
      const barEl = document.getElementById('mgrBar');
      if (barEl && window.Chart) {
        // ensure the canvas parent has a fixed height so Chart.js doesn't stretch
        if (barEl.parentElement) barEl.parentElement.style.height = '260px';

        const labels = properties.map(p=>p.name);
        const data = properties.map(p=>p.units);
        const maxVal = Math.max(...data);
        const suggestedMax = Math.ceil(maxVal * 1.15 / 10) * 10; // little headroom, rounded

        new Chart(barEl, {
          type:'bar',
          data:{
            labels,
            datasets:[{
              label:'Units',
              data,
              backgroundColor:'#3b82f6',
              maxBarThickness: 48
            }]
          },
          options:{
            maintainAspectRatio:false,
            plugins:{legend:{display:false}},
            scales:{
              y:{
                beginAtZero:true,
                suggestedMax: suggestedMax,
                ticks:{ precision:0 }
              }
            }
          }
        });
      }
      const donutEl = document.getElementById('mgrDonut');
      if (donutEl && window.Chart) {
        // Ensure parent has explicit height so the donut doesn't stretch
        if (donutEl.parentElement) donutEl.parentElement.style.height = '220px';
        const totalUnits = properties.reduce((s,p)=>s+p.units,0);
        const occupied = properties.reduce((s,p)=>s+p.occupied,0);
        new Chart(donutEl, {
          type:'doughnut',
          data:{
            labels:['Occupied','Vacant'],
            datasets:[{ data:[occupied, Math.max(0, totalUnits - occupied)], backgroundColor:['#10b981','#f97316'] }]
          },
          options:{
            maintainAspectRatio:false,
            cutout:'60%',
            plugins:{legend:{position:'bottom'}},
            layout:{padding:8}
          }
        });
      }

      // Report generation: create a simple CSV preview & download
      let lastReportCsv = null;
      document.getElementById('generateReportBtn').addEventListener('click', function(){
        const prop = document.getElementById('reportProperty').value;
        const from = document.getElementById('reportFrom').value || '2024-01-01';
        const to = document.getElementById('reportTo').value || new Date().toISOString().slice(0,10);
        const rows = (prop === 'all' ? properties : properties.filter(p=>p.name===prop)).map(p=>({
          property: p.name, units: p.units, occupied: p.occupied, income: p.income
        }));
        // build CSV
        const header = ['property','units','occupied','income'];
        const csv = [header.join(',')].concat(rows.map(r=>[r.property,r.units,r.occupied,r.income].join(','))).join('\n');
        lastReportCsv = csv;
        document.getElementById('reportPreview').textContent = `Report: ${prop} • ${from} → ${to} • ${rows.length} rows`;
      });

      document.getElementById('downloadReportBtn').addEventListener('click', function(){
        if (!lastReportCsv) {
          const t = document.createElement('div'); t.textContent = 'Generate a report first.'; Object.assign(t.style,{position:'fixed',right:'18px',bottom:'18px',background:'#b91c1c',color:'#fff',padding:'10px',borderRadius:'8px'}); document.body.appendChild(t); setTimeout(()=>t.remove(),2000); return;
        }
        const blob = new Blob([lastReportCsv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'property-report.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      // Quick actions: demo feedback
      ['btnNewTenant','btnNewProperty','btnInviteClient','btnExport'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.addEventListener('click', ()=> {
          const t = document.createElement('div'); t.textContent = 'Action "'+el.textContent.trim()+'" (demo)'; Object.assign(t.style,{position:'fixed',right:'18px',bottom:'18px',background:'#111',color:'#fff',padding:'10px',borderRadius:'8px'}); document.body.appendChild(t); setTimeout(()=>t.remove(),1800);
        });
      });

    })();
  </script>
</body>
</html>
